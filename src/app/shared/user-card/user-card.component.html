<mat-card class="mat-app-background basic-container card">
  <mat-card-header>
    <div mat-card-avatar class="example-header-image">
      <mat-icon class="mat-large">{{user.vehicleType == 'car' ? 'directions_car' : (user.vehicleType == 'quad' ?
        'agriculture' : 'two_wheeler')}}</mat-icon>
    </div>
    <mat-card-title>{{user.metadata.vehicle.plate}}</mat-card-title>
    <mat-card-subtitle>{{user.metadata.vehicle.make}} {{user.metadata.vehicle.model}}</mat-card-subtitle>
  </mat-card-header>
  <!--<img mat-card-image src="https://material.angular.io/assets/img/examples/shiba2.jpg" alt="Photo of a Shiba Inu">-->
  <mat-card-content class="card-content">
    <mat-list>
      <div mat-subheader>
        <h3>Ocupantes - {{user.metadata.people.length}}</h3>
      </div>
      <mat-list-item *ngFor="let person of user.metadata.people">
        <mat-icon matListItemIcon>{{person.type == 'driver' ? 'sports_motorsports' : 'hail'}}</mat-icon>
        <div matListItemTitle>{{person.name}}</div>
        <div matListItemLine>{{person.phoneNumber}}</div>
        <div matListItemLine *ngIf="person.cc != null">CC: {{person.cc}}</div>
        <div matListItemLine *ngIf="person.driversLicense != null">Carta Condução: {{person.driversLicense}}</div>
      </mat-list-item>
    </mat-list>
    <mat-divider></mat-divider>
    <mat-list>
      <mat-list-item>
        <span matListItemTitle>Checked in</span>
        <span matListItemLine>{{user.checkedIn ? 'SIM' : 'NÃO'}}</span>
        <span matListItemLine *ngIf="user.metadata.checkIn.byWho != null">Data/hora:{{user.metadata.checkIn.checkInAt|
          date : "medium"}}</span>
      </mat-list-item>
      <mat-list-item>
        <span matListItemTitle>Pago</span>
        <span matListItemLine class="{{user.paid ? 'green': 'warn'}}">{{user.paid ? 'SIM': 'NÃO'}}</span>
      </mat-list-item>
    </mat-list>
  </mat-card-content>
  
  <!-- Audit Trail Section -->
  <mat-accordion *ngIf="hasChangeHistory()">
    <mat-expansion-panel class="audit-trail-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>history</mat-icon>
          <span class="audit-title">Histórico de Alterações</span>
        </mat-panel-title>
        <mat-panel-description>
          {{user.metadata.changeHistory.length}} {{user.metadata.changeHistory.length === 1 ? 'entrada' : 'entradas'}}
        </mat-panel-description>
      </mat-expansion-panel-header>
      
      <mat-list class="audit-list">
        <mat-list-item *ngFor="let entry of user.metadata.changeHistory; let last = last" class="audit-entry">
          <div class="audit-entry-content">
            <div class="audit-entry-header">
              <mat-chip [color]="getActionColor(entry.action)" highlighted>
                {{getActionLabel(entry.action)}}
              </mat-chip>
              <span class="audit-timestamp">{{entry.timestamp | date:'short'}}</span>
            </div>
            <div class="audit-description">{{entry.description}}</div>
          </div>
          <mat-divider *ngIf="!last"></mat-divider>
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>
  </mat-accordion>
  
  <mat-card-actions>
    <button mat-button *ngIf="!user.checkedIn && user.paid" (click)="manualCheckInUser()">CHECK IN</button>
    <button mat-button *ngIf="user.checkedIn" (click)="cancelCheckInUser()">CANCELAR CHECK IN</button>
    <button mat-button (click)="editUser()">EDITAR</button>
    <button mat-button (click)="clearSelectedUser()">LIMPAR</button>
  </mat-card-actions>
</mat-card>
